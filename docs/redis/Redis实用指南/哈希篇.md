`Redis`å“ˆå¸Œ`(Hashes)`æ˜¯ä¸€ç§æ•°æ®ç±»åž‹ï¼Œè¡¨ç¤ºå­—ç¬¦ä¸²å­—æ®µå’Œå­—ç¬¦ä¸²å€¼ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚`Redis`å“ˆå¸Œç»“æž„å­˜å‚¨ä¸€ç»„å­—æ®µå€¼å¯¹ï¼Œè®¾è®¡ä¸Šä¸å ç”¨å¤ªå¤šç©ºé—´ï¼Œå› æ­¤éžå¸¸é€‚åˆè¡¨ç¤ºæ•°æ®å¯¹è±¡ã€‚å®ƒæä¾›äº†æ·»åŠ ã€èŽ·å–æˆ–åˆ é™¤å•ä¸ªé¡¹ã€èŽ·å–æ•´ä¸ªå“ˆå¸Œå€¼æˆ–å°†å“ˆå¸Œå€¼ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µç”¨ä½œè®¡æ•°å™¨çš„åŠŸèƒ½ã€‚

![redis-hashes](https://redis.com/wp-content/uploads/2019/07/data-structures-_hashes.svg?&auto=webp&quality=85,75&width=800)

## åœºæ™¯

å“ˆå¸Œä½¿ç”¨çš„åœºæ™¯ç‰¹åˆ«å¹¿æ³›ï¼Œç”šè‡³éƒ½å¯ä»¥å½“æ•°æ®åº“æ¥ç”¨**ðŸ¶**ã€‚æ¯”å¦‚ï¼Œå­˜å‚¨é…ç½®ä¿¡æ¯ç­‰ç­‰åœºæ™¯ã€‚

### å¯¹è±¡å­˜å‚¨
å­˜å‚¨å¯¹è±¡æ˜¯å“ˆå¸Œæœ€åŸºæœ¬çš„ä½¿ç”¨åœºæ™¯, æ¯”å¦‚ç”¨æˆ·å¯¹è±¡ï¼Œå•†å“å¯¹è±¡ï¼Œæ´»åŠ¨å¯¹è±¡ç­‰ç­‰å¯ä»¥è¯´ä¸€åˆ‡çš„å¯¹è±¡ã€‚

- ç”¨æˆ·å¯¹è±¡

å“ˆå¸Œå¯ä»¥ç”¨æ¥å­˜å‚¨ç”¨æˆ·å¯¹è±¡çš„ä¿¡æ¯ï¼Œæ¯ä¸ªç”¨æˆ·å¯¹è±¡å¯ä»¥åŒ…å«å¤šä¸ªå­—æ®µï¼Œå¦‚ç”¨æˆ·åã€å¯†ç ã€ç”µå­é‚®ä»¶ç­‰ï¼Œè¿™æ ·å¯ä»¥å°†ç”¨æˆ·ä¿¡æ¯ç»„ç»‡æˆä¸€ä¸ªå“ˆå¸Œï¼Œæ–¹ä¾¿ç®¡ç†å’ŒæŸ¥è¯¢ã€‚

- å•†å“ä¿¡æ¯
  
å¯¹äºŽç”µå­å•†åŠ¡å¹³å°ï¼Œå•†å“ä¿¡æ¯å¯ä»¥è¢«å­˜å‚¨ä¸ºå“ˆå¸Œï¼Œæ¯ä¸ªå•†å“çš„å„ç§å±žæ€§ï¼ˆå¦‚åç§°ã€ä»·æ ¼ã€åº“å­˜ç­‰ï¼‰å¯ä»¥ä½œä¸ºå“ˆå¸Œçš„å­—æ®µï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°æŸ¥è¯¢å’Œæ›´æ–°å•†å“ä¿¡æ¯ã€‚


```php
// å•†å“ä¿¡æ¯
$goods = $user = $activity = [];
$redis->hMSet('goods:1', $goods);

```

### ç¼“å­˜å­˜å‚¨

å“ˆå¸Œå¯ä»¥ç”¨æ¥å­˜å‚¨ç¼“å­˜æ•°æ®ï¼Œä¾‹å¦‚å°†ä¸€äº›å¸¸ç”¨çš„è®¡ç®—ç»“æžœæˆ–æ•°æ®åº“æŸ¥è¯¢ç»“æžœå­˜å‚¨ä¸ºå“ˆå¸Œï¼Œå¯ä»¥æé«˜è®¿é—®é€Ÿåº¦å¹¶å‡å°‘æ•°æ®åº“åŽ‹åŠ›ã€‚

```php

$cacheData = $redis->hGetAll('cache:result');
if (!empty($cacheData)) {
    return $cacheData;
}
// todo èŽ·å–æˆ–è€…è®¡ç®—æ•°æ®æ“ä½œ

```

### é…ç½®ç®¡ç†

å¯ä»¥å°†ç³»ç»Ÿçš„é…ç½®ä¿¡æ¯å­˜å‚¨ä¸ºå“ˆå¸Œï¼Œæ¯ä¸ªé…ç½®é¡¹å¯¹åº”ä¸€ä¸ªå­—æ®µï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œé…ç½®çš„è¯»å–å’Œæ›´æ–°ã€‚

```php

// åˆ¤æ–­æŸé¡¹åŠŸèƒ½æ˜¯å¦å¼€å¯ 
if (!($openComment = $redis->hGet('site:config', 'openComment'))) {
    // todo
    return false
}
// todo


```

### å®žæ—¶è®¡æ•°å™¨

å“ˆå¸Œå¯ä»¥ç”¨æ¥å®žçŽ°å®žæ—¶è®¡æ•°å™¨ï¼Œä¾‹å¦‚ç»Ÿè®¡ç½‘ç«™çš„è®¿é—®é‡ã€ç”¨æˆ·çš„ç™»å½•æ¬¡æ•°ç­‰ï¼Œæ¯ä¸ªè®¡æ•°å™¨å¯¹åº”ä¸€ä¸ªå­—æ®µï¼Œé€šè¿‡å¢žå‡å­—æ®µçš„å€¼æ¥å®žçŽ°è®¡æ•°ã€‚

```php
// è®¿é—®é‡+1
$redis->hIncrBy('site:20240322', 'visit', 1);
// åœ¨çº¿æ•°+1
$redis->hIncrBy('site:20240322', 'online', 1);
// ç™»å½•æ¬¡æ•°+1
$redis->hIncrBy('site:20240322', 'login_{uid}', 1);

```

### ä¼šè¯ç®¡ç†

å“ˆå¸Œå¯ä»¥ç”¨æ¥å­˜å‚¨ç”¨æˆ·ä¼šè¯ä¿¡æ¯ï¼Œæ¯ä¸ªç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯å¯ä»¥å­˜å‚¨ä¸ºä¸€ä¸ªå“ˆå¸Œï¼ŒåŒ…å«ç”¨æˆ·çš„ç™»å½•çŠ¶æ€ã€æƒé™ä¿¡æ¯ç­‰ã€‚

```php
$session = [
    'uid' => '',
    'roles' => [],
    'email' => '',
];
$redis->hMSet('session_id', $session);
```

### å¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆORMï¼‰

åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¯ä»¥ä½¿ç”¨å“ˆå¸Œæ¥å­˜å‚¨å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼Œä¾‹å¦‚å°†ç”¨æˆ·å’Œå…¶å…³æ³¨çš„äººå­˜å‚¨ä¸ºå“ˆå¸Œï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œå¥½å‹å…³ç³»çš„ç®¡ç†å’ŒæŸ¥è¯¢ã€‚

```php
// ç”¨æˆ·å¯¹è±¡
$redis->hMSet('user:1', []);
$redis->hMSet('user:2', []);
$redis->hMSet('user:3', []);
// 1å…³æ³¨çš„äºº
$redis->hset('user:1:follows', 2, 1);
$redis->hset('user:1:follows', 3, 1);
// èŽ·å–å…³æ³¨åˆ—è¡¨
$redis->hKeys('user:1:follows');

```
> ç”¨æˆ·å…³æ³¨çš„äººç”¨é›†åˆå¤„ç†æ›´åˆé€‚.


### ç§’æ€å‡åº“å­˜

æ¯”å¦‚åŽå°åˆ›å»ºç§’æ€å•†å“æ—¶å°†ä¿¡æ¯å­˜æ”¾åœ¨`hash`ä¸­ï¼Œå‰å°ç›´æŽ¥æ‰£é™¤`hash`ä¸­çš„åº“å­˜å­—æ®µã€‚

```php
// ä»£è¡¨åº“å­˜æ²¡æœ‰äº†
if ($redis->hIncrBy('goods:1', 'stock', -1) < 0) {
    return 'ä½ æ¥æ™šäº†';
}
// todo


```


## åä½œ

å¦‚æžœä½ æœ‰æ›´å¤šçš„åœºæ™¯ä½¿ç”¨ç”¨ä¾‹ï¼Œå¯ä»¥é€šè¿‡`github`æäº¤`pr`è¯·æ±‚ã€‚æœ‰é—®é¢˜å¯ä»¥å¼€`issue`ã€‚
[ç¼–è¾‘æ­¤é¡µé¢](https://github.com/TianLiangZhou/loocode.com/blob/main/docs/redis/Redis%E5%AE%9E%E7%94%A8%E6%8C%87%E5%8D%97/%E5%93%88%E5%B8%8C%E7%AF%87.md)
