{% extends '@OctopusPress/base.html.twig' %}
{% block style %}
<link rel="stylesheet" href="{{ asset('assets/css/tools.css') }}" />
<script>
    // fix https://github.com/alpinejs/alpine/discussions/1705
    // <!-- ✅ After -->
    document.addEventListener('alpine:init', () => {
        // Will be executed before initializing Alpine.
        Alpine.data("toolConvert", () => ({
            mode: 0,
            data: null,
            algo: '',
            loading: false,
            convert() {
                if (this.loading) {
                    return;
                }
                /** @type {HTMLFormElement} */
                var form = this.$refs.form;
                if (!form.checkValidity()) {
                    alert('必填项不能为空！');
                    return ;
                }
                this.loading = true;
                window.fetch('/tool/convert', {
                    method: 'POST',
                    body: new FormData(this.$refs.form),
                }).then((response) => {
                    this.loading = false;
                    response.json().then((body) => {
                        this.data = body.data || body.message;
                    }).catch((err) => {
                        console.log(err);
                    });
                }).catch((err) => {
                    this.loading = false;
                    console.log(err);
                })
            },
            randomIV() {
                var formData = new FormData();
                formData.append('algo', this.$refs.form.algo.value);
                this.$refs.form.iv_base64.checked = true;
                window.fetch('/tool/random_iv', {
                    method: 'POST',
                    body: formData,
                }).then((response) => {
                    response.json().then((body) => {
                        this.$refs.form.iv.value = body.data;
                    }).catch((err) => {
                        console.log(err);
                    });
                }).catch((err) => {
                    console.log(err);
                });
            }
        }));
    });
</script>
{% endblock %}
{% block body %}
    <div class="container mx-auto my-5 px-4">
        <div class="isolate pt-4">
            {{ widget('breadcrumb', {template: 'summer/breadcrumb.html.twig'}) }}
        </div>
        <div class="flex pt-4 flex-col">
            <div class="mt-4">
                <div class="bg-white py-4 dark:bg-slate-800 rounded-t-lg">
                    <div class="">
                        <ul class="flex flex-wrap font-semibold text-slate-900 text-left dark:text-slate-500">
                            {% for item in tools|filter(v => v.group is defined and v.group == group) %}
                                <li class="flex py-3 ml-6 {% if tool.name == item.name %} border-b-4 border-primary {% endif %}">
                                    {% if tool.name == item.name %}
                                        <span class="!text-primary">{{ item.name }}</span>
                                    {% else %}
                                        <a href="{{ item.href }}" class="relative w-full hover:underline hover:text-primary">{{item.name}}</a>
                                    {% endif %}
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
            <div class="">
                <div class="bg-white dark:bg-slate-800 rounded-b-lg" x-data="toolConvert">
                    <div class="p-6 relative dark:border-slate-700">
                        <form name="body" x-ref="form">
                            <input type="hidden" name="tool" value="{{name}}">
                            {% block child %}{% endblock %}
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
